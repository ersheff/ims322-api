<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile Creator</title>
</head>

<body>

  <style>
    * {
      font-family: Arial, Helvetica, sans-serif;
      line-height: 1.5em;
    }

    body {
      max-width: 600px;
      margin: auto;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
  </style>

  <!-- DO NOT REMOVE OR CHANGE THE METHOD ATTRIBUTE -->
  <dialog id="modal">
    <form method="dialog">
      <div>
        <label for="name">Name:</label><br>
        <input type="text" name="name">
      </div>
      <div>
        <label for="age">Age:</label><br>
        <input type="number" name="age">
      </div>
      <div>
        <label for="location">Location:</label><br>
        <input type="text" name="location">
      </div>
      <input type="submit" value="Submit">
    </form>
  </dialog>

  <h1>Serverless Function Echo</h1>
  <p>This simple serverless function, running on Vercel, echoes submitted form values back to the client as JSON.</p>
  <p>It has been used in project templates for a class to introduce students to working with an API; specifically, how
    to receive and process
    incoming data.</p>
  <p>From the server:</p>

  <main></main>

  <script>
    const modal = document.querySelector('#modal');
    modal.showModal();

    const form = document.querySelector('form');

    form.addEventListener('submit', async (event) => {
      const data = await handleForm(event);
      document.querySelector('main').innerText = JSON.stringify(data, null, 2);
    });

    async function handleForm(event) {
      const formData = new FormData(event.target);
      const formBody = new URLSearchParams(formData).toString();

      try {
        const response = await fetch('https://ims322-api.vercel.app/api/echoFormData', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          body: formBody
        });
        return await response.json();
      } catch (err) {
        console.error(err);
      }
    }
  </script>

</body>

</html>